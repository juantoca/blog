---
import LanguageSwitcher from '@/components/LanguageSwitcher.astro'
import Link from '@/components/Link.astro'
import SearchButton from '@/components/react/SearchButton'
import ThemeToggle from '@/components/ThemeToggle.astro'
import MobileMenu from '@/components/ui/mobile-menu'
import { NAV_LINKS, SOCIAL_LINKS } from '@/consts'
import { Icon } from 'astro-icon/components'
import SocialIcons from './SocialIcons.astro'

import { getLanguageFromUrl, localizeString, localizeUrl } from '@/lib/i18n'

const currentPath = Astro.originPathname

const isExternalLink = (href: string) => {
  return href.startsWith('http')
}
---

<header
  class="bg-background/50 sticky top-0 z-10 backdrop-blur-md"
  transition:persist
>
  <div
    class="mx-auto flex max-w-3xl flex-wrap items-center justify-between gap-4 p-2"
  >
    <Link
      href={localizeUrl('/', Astro)}
      class="flex shrink-0 items-center gap-2 text-xl font-medium"
      data-astro-reload
    >
      <img
        src="/static/face.jpg"
        alt="index"
        width="64"
        height="64"
        class="hidden min-[400px]:block rounded-full"
        loading="eager"
        fetchpriority="high"
      />
      <img
        src="/static/face.jpg"
        alt="index"
        width="48"
        height="48"
        class="hidden max-[400px]:block rounded-full"
        loading="eager"
        fetchpriority="high"
      />
      <!-- <span class="hidden min-[400px]:block">{SITE.title}</span> -->
    </Link>

    <div class="flex-item items-left hidden min-[460px]:block">
      <SocialIcons links={SOCIAL_LINKS} />
    </div>

    <div class="flex items-center gap-2 md:gap-4">
      <nav class="hidden items-center gap-4 text-sm sm:gap-6 md:flex">
        {
          NAV_LINKS.map((item) => {
            const isExternal = isExternalLink(item.href)
            const isInsideLink = item.label.toLowerCase() === 'inside'
            return (
              <Link
                href={isExternal ? item.href : localizeUrl(item.href, Astro)}
                class={
                  isInsideLink
                    ? 'text-primary hover:text-primary/80 flex items-center gap-1.5 font-medium capitalize transition-colors'
                    : 'text-foreground/60 hover:text-foreground/80 flex items-center gap-1.5 capitalize transition-colors'
                }
              >
                <span>{
                  localizeString(Astro, item.translations)
                }</span>
                {isExternal && (
                  <Icon
                    name="lucide:external-link"
                    class={
                      isInsideLink
                        ? 'text-primary size-3.5 flex-shrink-0 opacity-80'
                        : 'size-3.5 flex-shrink-0 opacity-70'
                    }
                    aria-hidden="true"
                  />
                )}
              </Link>
            )
          })
        }
      </nav>
      <div class="bg-border/60 hidden h-6 w-px md:block" aria-hidden="true">
      </div>
      <SearchButton client:idle />
      <LanguageSwitcher currentPath={currentPath} class="md:block" />
      <MobileMenu language={getLanguageFromUrl(currentPath)} client:idle client:only="react" transition:persist>
        <div class="flex-item items-left hidden max-[460px]:block social-icons-mobile-menu">
          <SocialIcons links={SOCIAL_LINKS} />
        </div>
      </MobileMenu>

      <ThemeToggle transition:persist />
    </div>
  </div>
</header>
